# 实现计划: Mindcraft 可视化管理平台

## 概述

本计划将 Mindcraft 可视化管理平台的设计分解为可执行的编码任务。采用前后端分离架构，先搭建后端 API，再构建前端界面，最后进行集成测试。

## 任务列表

- [x] 1. 项目初始化和基础架构
  - [x] 1.1 创建项目目录结构
    - 创建 `server/` 和 `client/` 目录
    - 初始化 package.json 和 TypeScript 配置
    - _需求: 全局_

  - [x] 1.2 搭建后端 Express 服务器
    - 创建 Express 应用入口
    - 配置 CORS、JSON 解析中间件
    - 配置 Socket.IO 服务器
    - _需求: 6.1_

  - [x] 1.3 搭建前端 Vite + React 项目
    - 使用 Vite 创建 React + TypeScript 项目
    - 配置 TailwindCSS
    - 安装 shadcn/ui 和 Lucide React
    - _需求: 全局_

- [x] 2. 数据模型和类型定义
  - [x] 2.1 创建共享类型定义
    - 定义 BotProfile、APIKeys、ServerSettings、Task 等接口
    - 定义 API 请求/响应类型
    - 定义 WebSocket 事件类型
    - _需求: 全局_

  - [ ]* 2.2 编写配置验证属性测试
    - **Property 3: 配置验证正确性**
    - **验证: 需求 2.3**

- [x] 3. 后端 API 实现 - 机器人配置
  - [x] 3.1 实现机器人配置文件读写服务
    - 读取 profiles/ 目录下的 JSON 文件
    - 写入和更新配置文件
    - 删除配置文件
    - _需求: 2.1, 2.3, 2.4, 2.5_

  - [x] 3.2 实现机器人配置 REST API
    - GET /api/bots - 获取所有配置
    - GET /api/bots/:id - 获取单个配置
    - POST /api/bots - 创建配置
    - PUT /api/bots/:id - 更新配置
    - DELETE /api/bots/:id - 删除配置
    - _需求: 2.1, 2.3, 2.4, 2.5_

- [x] 4. 后端 API 实现 - API 密钥管理
  - [x] 4.1 实现 API 密钥读写服务
    - 读取 keys.json 文件
    - 更新指定提供商的密钥
    - 删除指定提供商的密钥
    - _需求: 3.3_

  - [x] 4.2 实现 API 密钥 REST API
    - GET /api/keys - 获取密钥状态（不返回实际密钥）
    - PUT /api/keys/:provider - 更新密钥
    - DELETE /api/keys/:provider - 删除密钥
    - _需求: 3.1, 3.3, 3.5_

  - [ ]* 4.3 编写密钥格式验证属性测试
    - **Property 6: 密钥格式验证正确性**
    - **验证: 需求 3.4**

  - [ ]* 4.4 编写密钥状态指示属性测试
    - **Property 7: 密钥状态指示正确性**
    - **验证: 需求 3.5**

- [x] 5. 后端 API 实现 - 服务器设置
  - [x] 5.1 实现设置读写服务
    - 读取 settings.js 配置
    - 更新设置配置
    - _需求: 4.1, 4.2, 4.3, 4.5_

  - [x] 5.2 实现设置 REST API
    - GET /api/settings - 获取设置
    - PUT /api/settings - 更新设置
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 6. 后端 API 实现 - 任务管理
  - [x] 6.1 实现任务读写服务
    - 读取 tasks/ 目录下的任务文件
    - 创建和删除任务
    - _需求: 5.1, 5.2, 5.3_

  - [x] 6.2 实现任务 REST API
    - GET /api/tasks - 获取所有任务
    - POST /api/tasks - 创建任务
    - DELETE /api/tasks/:id - 删除任务
    - _需求: 5.1, 5.2, 5.3_

- [x] 7. 检查点 - 后端 API 完成
  - 确保所有 API 端点正常工作
  - 如有问题请询问用户

- [x] 8. 后端实现 - 机器人进程管理
  - [x] 8.1 实现进程管理器
    - 启动 Mindcraft main.js 进程
    - 停止运行中的进程
    - 跟踪进程状态
    - _需求: 7.1, 7.2, 7.5_

  - [x] 8.2 实现机器人控制 API
    - POST /api/bots/:id/start - 启动机器人
    - POST /api/bots/:id/stop - 停止机器人
    - GET /api/bots/:id/status - 获取状态
    - _需求: 7.1, 7.2, 7.3, 7.4_

  - [ ]* 8.3 编写启动前置条件验证属性测试
    - **Property 10: 启动前置条件验证**
    - **验证: 需求 7.3**

- [x] 9. 后端实现 - WebSocket 实时通信
  - [x] 9.1 实现 WebSocket 事件处理
    - 处理客户端订阅/取消订阅
    - 广播机器人状态更新
    - 广播日志消息
    - _需求: 6.1, 6.2, 6.3_

  - [x] 9.2 实现进程输出捕获
    - 捕获 stdout/stderr 输出
    - 解析日志级别
    - 通过 WebSocket 推送日志
    - _需求: 6.1, 6.4_

- [x] 10. 后端实现 - 配置导入导出
  - [x] 10.1 实现导入导出服务
    - 导出所有配置为 JSON
    - 验证导入的 JSON 格式
    - 应用导入的配置
    - _需求: 8.1, 8.2, 8.3, 8.4_

  - [x] 10.2 实现导入导出 API
    - GET /api/export - 导出配置
    - POST /api/import - 导入配置
    - _需求: 8.1, 8.2_

  - [ ]* 10.3 编写配置往返一致性属性测试
    - **Property 5: 配置往返一致性**
    - **验证: 需求 3.3, 8.1**

  - [ ]* 10.4 编写导入格式验证属性测试
    - **Property 11: 导入格式验证正确性**
    - **验证: 需求 8.2**

- [x] 11. 检查点 - 后端完成
  - 确保所有后端功能正常工作
  - 如有问题请询问用户

- [x] 12. 前端实现 - 基础布局和路由
  - [x] 12.1 创建应用布局组件
    - 顶部导航栏
    - 侧边栏导航
    - 主内容区域
    - _需求: 全局_

  - [x] 12.2 配置路由
    - 仪表盘路由 /
    - 机器人详情路由 /bots/:id
    - 设置路由 /settings
    - 任务路由 /tasks
    - _需求: 1.3_

- [x] 13. 前端实现 - 状态管理和 API 客户端
  - [x] 13.1 创建 Zustand 状态存储
    - 机器人列表状态
    - API 密钥状态
    - 设置状态
    - 任务状态
    - _需求: 全局_

  - [x] 13.2 创建 API 客户端
    - 封装 fetch 请求
    - 错误处理
    - _需求: 全局_

  - [x] 13.3 创建 WebSocket 客户端
    - 连接管理
    - 事件订阅
    - 自动重连
    - _需求: 6.1_

- [x] 14. 前端实现 - 仪表盘页面
  - [x] 14.1 实现机器人卡片组件
    - 显示机器人名称和模型
    - 显示状态指示器（圆点 + 文字）
    - 启动/停止按钮
    - _需求: 1.1, 1.2, 7.1, 7.2_

  - [x] 14.2 实现仪表盘页面
    - 机器人卡片网格布局
    - 状态统计（活跃/非活跃数量）
    - 创建机器人按钮
    - _需求: 1.1, 1.2, 1.4_

  - [ ]* 14.3 编写机器人列表渲染属性测试
    - **Property 1: 机器人列表渲染正确性**
    - **验证: 需求 1.1, 5.1**

  - [ ]* 14.4 编写状态计数属性测试
    - **Property 2: 状态计数正确性**
    - **验证: 需求 1.4**

- [x] 15. 前端实现 - 机器人配置编辑器
  - [x] 15.1 实现模型配置表单
    - API 提供商选择
    - 模型名称输入
    - 高级参数配置
    - _需求: 2.2, 2.6_

  - [x] 15.2 实现机器人编辑器页面
    - 基本信息表单（名称）
    - 多模型配置（chat/code/vision/embedding）
    - 保存/取消按钮
    - 删除确认对话框
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6_

- [x] 16. 前端实现 - API 密钥管理
  - [x] 16.1 实现密钥管理页面
    - 提供商列表
    - 密钥输入框（遮蔽显示）
    - 配置状态指示
    - 保存/删除按钮
    - _需求: 3.1, 3.2, 3.4, 3.5_

  - [ ]* 16.2 编写密钥遮蔽属性测试
    - **Property 4: 密钥遮蔽正确性**
    - **验证: 需求 3.2**

- [x] 17. 前端实现 - 服务器设置
  - [x] 17.1 实现设置页面
    - 服务器地址输入
    - 端口输入
    - 认证模式切换
    - Minecraft 版本选择
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_

- [x] 18. 前端实现 - 任务管理
  - [x] 18.1 实现任务列表组件
    - 任务卡片
    - 启动任务按钮
    - 删除任务按钮
    - _需求: 5.1, 5.4_

  - [x] 18.2 实现任务创建表单
    - 目标描述输入
    - 目标物品选择
    - 数量和超时设置
    - 初始物品栏配置
    - _需求: 5.2, 5.3_

- [x] 19. 前端实现 - 实时监控
  - [x] 19.1 实现日志查看器组件
    - 日志列表（虚拟滚动）
    - 级别过滤
    - 错误高亮
    - _需求: 6.1, 6.4, 6.5_

  - [x] 19.2 实现监控面板
    - 日志查看器
    - 位置显示
    - 物品栏显示
    - _需求: 6.1, 6.2, 6.3_

  - [ ]* 19.3 编写日志过滤属性测试
    - **Property 8: 日志过滤正确性**
    - **验证: 需求 6.5**

  - [ ]* 19.4 编写错误高亮属性测试
    - **Property 9: 错误高亮正确性**
    - **验证: 需求 6.4**

- [x] 20. 前端实现 - 配置导入导出
  - [x] 20.1 实现导入导出功能
    - 导出按钮（下载 JSON）
    - 导入按钮（文件选择）
    - 导入预览和确认
    - 错误提示
    - _需求: 8.1, 8.2, 8.3, 8.4_

- [x] 21. 检查点 - 前端完成
  - 确保所有前端功能正常工作
  - 如有问题请询问用户

- [x] 22. 集成和优化
  - [x] 22.1 前后端集成测试
    - 测试所有 API 调用
    - 测试 WebSocket 通信
    - 测试机器人启动/停止流程
    - _需求: 全局_

  - [x] 22.2 错误处理优化
    - 添加全局错误边界
    - 优化错误提示
    - _需求: 7.4, 8.3_

- [x] 23. 最终检查点
  - 确保所有测试通过
  - 如有问题请询问用户

## 备注

- 标记 `*` 的任务为可选任务，可跳过以加快 MVP 开发
- 每个任务都引用了具体的需求以便追溯
- 检查点用于确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边界情况
