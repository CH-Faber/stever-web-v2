# 日志持久化 - 快速入门

## 功能概述

现在每次机器人启动都会创建一个独立的日志存档，你可以随时查看历史日志记录。

## 主要特性

✅ **自动存档** - 每次启动自动创建新的日志会话  
✅ **独立存储** - 每个会话有独立的日志文件  
✅ **历史查看** - 可以查看任何历史会话的完整日志  
✅ **日志过滤** - 按级别（info/warn/error）过滤日志  
✅ **日志下载** - 支持下载日志文件到本地  
✅ **会话管理** - 可以删除不需要的历史日志  

## 使用方法

### 1. 查看实时日志

在机器人详情页面，实时日志会自动显示在"实时监控"面板中。

### 2. 查看历史日志

**方法一：从机器人详情页**
1. 进入机器人详情页
2. 在"实时监控"面板右上角点击"历史日志"按钮
3. 查看该机器人的所有历史会话

**方法二：从导航菜单**
1. 点击导航栏的"日志"菜单（如果有）
2. 查看所有机器人的历史会话

### 3. 查看会话详情

1. 在历史日志列表中，点击"查看日志"按钮
2. 查看该会话的完整日志
3. 可以使用过滤器按日志级别筛选
4. 点击"下载日志"按钮保存到本地

### 4. 删除历史日志

1. 在历史日志列表中，点击垃圾桶图标
2. 确认删除
3. 日志文件将被永久删除

## 日志存储位置

所有日志文件存储在项目根目录的 `logs/` 文件夹中：

```
logs/
├── sessions.json                          # 会话索引
├── bot_xxx_2026-01-16T10-30-00-000Z.jsonl # 日志文件
└── bot_yyy_2026-01-16T11-00-00-000Z.jsonl
```

## 日志文件格式

日志使用 JSON Lines 格式（.jsonl），每行一个 JSON 对象：

```jsonl
{"type":"session_start","sessionId":"...","botId":"...","botName":"...","startTime":"..."}
{"type":"log","timestamp":"...","level":"info","message":"...","source":"..."}
{"type":"log","timestamp":"...","level":"error","message":"...","source":"..."}
{"type":"session_end","sessionId":"...","endTime":"..."}
```

你可以使用任何文本编辑器打开这些文件，或者使用专门的 JSON Lines 工具处理。

## 常见问题

### Q: 日志会占用多少空间？

A: 取决于机器人的活跃程度。一般情况下，一个小时的运行日志大约 1-5 MB。建议定期清理不需要的历史日志。

### Q: 可以自动清理旧日志吗？

A: 目前需要手动删除。未来版本会添加自动清理功能。

### Q: 日志文件可以直接删除吗？

A: 可以，但建议通过 UI 删除，这样会同时更新 `sessions.json` 索引文件。如果直接删除文件，需要手动编辑 `sessions.json`。

### Q: 实时日志和历史日志有什么区别？

A: 
- **实时日志**: 存储在内存中，最多保留 1000 条，机器人停止后会清空
- **历史日志**: 存储在文件中，永久保存，可以随时查看

### Q: 可以导出日志吗？

A: 可以，在日志会话查看器中点击"下载日志"按钮，会下载为 .log 文本文件。

## 技术细节

如果你想了解更多技术实现细节，请查看 [LOG_PERSISTENCE.md](./LOG_PERSISTENCE.md)。

## 反馈

如果遇到问题或有改进建议，欢迎提交 Issue！
